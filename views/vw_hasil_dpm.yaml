dependsOn:
  - ref_fakultas
  - vw_pilihan
export: out/vw_hasil_dpm.csv
sql: |
  WITH
  
  -- Penghitungan setiap fakultas

  -- Gunakan input_fakultas sebagai filter agar penghitungan suara tidak sah
  -- karena tidak terdaftar menjadi akurat
  counting_fh AS (
    SELECT
      input_fakultas AS fakultas,
      pilihan_dpm_fh AS pilihan_dpm,
      COUNT(*) AS jumlah_suara
    FROM tahap1.vw_pilihan
    WHERE
      suara_dpm_sah = TRUE AND
      input_fakultas = 'FH'
    GROUP BY input_fakultas, pilihan_dpm_fh
    ORDER BY pilihan_dpm DESC
  )

  SELECT * FROM counting_fh
